<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: Linear Regression - Modeling Biological Relationships | BIT07 Machine Learning Course</title>
    <link rel="stylesheet" href="/bit07/assets/css/bundle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-3.1.0.min.js" charset="utf-8"></script>
</head>
<body class="min-h-screen">
    <header class="bg-gradient-to-r from-primary-600 via-primary-700 to-secondary-600 text-white shadow-xl sticky top-0 z-50">
        <nav id="navbar" class="container mx-auto px-4 py-4">
            <div class="flex flex-wrap items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <h1><a href="/bit07/" class="text-2xl font-bold hover:text-blue-100 transition-colors">BIT07 Machine Learning</a></h1>
                </div>

                <!-- Mobile menu button -->
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <!-- Navigation menu -->
                <div id="nav-menu" class="hidden md:flex flex-wrap items-center space-x-1">
                    <a href="/bit07/" class="nav-link">Home</a>

                    <!-- Dropdown for Foundations -->
                    <div class="relative group">
                        <button class="nav-link flex items-center">
                            Foundations
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <div class="py-2">
                                <a href="/bit07/introduction/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Introduction</a>
                                <a href="/bit07/linear-regression/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Linear Regression</a>
                                <a href="/bit07/logistic-regression/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Logistic Regression</a>
                            </div>
                        </div>
                    </div>

                    <!-- Dropdown for Core Methods -->
                    <div class="relative group">
                        <button class="nav-link flex items-center">
                            Core Methods
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <div class="py-2">
                                <a href="/bit07/hyperparameter-tuning/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Hyperparameter Tuning</a>
                                <a href="/bit07/imbalanced-data/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Imbalanced Data</a>
                                <a href="/bit07/naive-bayes/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Naïve Bayes</a>
                                <a href="/bit07/decision-trees/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Decision Trees</a>
                            </div>
                        </div>
                    </div>

                    <!-- Dropdown for Advanced Topics -->
                    <div class="relative group">
                        <button class="nav-link flex items-center">
                            Advanced
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div class="absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <div class="py-2">
                                <a href="/bit07/ensemble-learning/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Ensemble Learning</a>
                                <a href="/bit07/clustering/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Clustering</a>
                                <a href="/bit07/dimensionality-reduction/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Dimensionality Reduction</a>
                                <a href="/bit07/ml-workflows/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">ML Workflows</a>
                                <a href="/bit07/neural-networks/" class="block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-600">Neural Networks</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile menu (hidden by default) -->
            <div id="mobile-nav" class="md:hidden mt-4 hidden">
                <div class="flex flex-col space-y-2">
                    <a href="/bit07/" class="nav-link-mobile">Home</a>
                    <a href="/bit07/introduction/" class="nav-link-mobile">Introduction</a>
                    <a href="/bit07/linear-regression/" class="nav-link-mobile">Linear Regression</a>
                    <a href="/bit07/logistic-regression/" class="nav-link-mobile">Logistic Regression</a>
                    <a href="/bit07/hyperparameter-tuning/" class="nav-link-mobile">Hyperparameters</a>
                    <a href="/bit07/imbalanced-data/" class="nav-link-mobile">Imbalanced Data</a>
                    <a href="/bit07/naive-bayes/" class="nav-link-mobile">Naïve Bayes</a>
                    <a href="/bit07/decision-trees/" class="nav-link-mobile">Decision Trees</a>
                    <a href="/bit07/ensemble-learning/" class="nav-link-mobile">Ensemble Learning</a>
                    <a href="/bit07/unsupervised-learning/" class="nav-link-mobile">Unsupervised Learning</a>
                    <a href="/bit07/ml-workflows/" class="nav-link-mobile">ML Workflows</a>
                    <a href="/bit07/neural-networks/" class="nav-link-mobile">Neural Networks</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="flex-1">
        <div class="container mx-auto px-4 py-8 max-w-6xl">
            
            <div class="mb-8 animate-fade-in">
                <h1 class="text-4xl md:text-5xl font-bold gradient-text mb-4">Chapter 2: Linear Regression - Modeling Biological Relationships</h1>
                <div class="w-24 h-1 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-full"></div>
            </div>
            

            <div class="prose prose-lg max-w-none animate-slide-up">
                <!-- Header -->
<div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Chapter 2: Linear Regression</h2>
    <p class="text-gray-700 leading-relaxed">Linear regression is a fundamental supervised learning algorithm used for regression tasks. It aims to model the linear relationship between one or more independent variables (features) and a continuous dependent variable (the target). Despite its simplicity, it is a powerful and interpretable tool for understanding relationships in biological data.</p>
</div>
<!-- Core Concepts Section -->
<div class="bg-white rounded-xl shadow-md p-6 mb-8">
    <h3 class="text-2xl font-bold text-gray-800 mb-6 mt-4 border-b pb-3">The Linear Regression Model</h3>
<p><div class="grid grid-cols-1 md:grid-cols-2 gap-8">
<div>
<h4 class="text-xl font-semibold text-gray-700 mb-3">The Hypothesis Function</h4>
<p class="text-gray-600 mb-4">For a single feature, the model assumes the relationship can be described by a straight line. This is the model's hypothesis:</p>
<div class="bg-gray-100 rounded-lg p-4 font-mono text-center">
<code class="text-lg">hθ(x) = θ₀ + θ₁x</code>
</div>
<div class="space-y-2 text-sm mt-4">
<p><code class="font-semibold">hθ(x)</code> is the predicted value.</p>
<p><code class="font-semibold">x</code> is the input feature (e.g., concentration of a chemical).</p>
<p><code class="font-semibold">θ₀</code> is the y-intercept (the baseline value when x=0).</p>
<p><code class="font-semibold">θ₁</code> is the slope, representing the change in the target for a one-unit change in x.</p>
</div>
<img src="/bit07/assets/images/linear_regression.png" alt="Linear Regression Hypothesis" class="w-half mx-auto">
</div>
<div>
<h4 class="text-xl font-semibold text-gray-700 mb-3">The Cost Function</h4>
<p class="text-gray-600 mb-4">To find the &quot;best fit&quot; line, we need to quantify how wrong our model is. This is done with a cost function, typically the Mean Squared Error (MSE).</p>
<div class="bg-gray-100 rounded-lg p-4 font-mono text-center">
<code class="text-lg">J(θ) = (1/2m) Σ(hθ(x⁽ⁱ⁾) - y⁽ⁱ⁾)²</code>
</div>
<div class="alert-info mt-4">
<strong>Analogy: A &quot;Disappointment Score&quot;</strong>
<p>Think of the cost function as a &quot;disappointment score&quot;. A high score means the model's predictions are far from the actual data (high disappointment). Our goal is to find the parameters (θ values) that give us the lowest possible disappointment.</p>
</div>
<img src="/bit07/assets/images/cost_function.png" alt="Cost Function Visualization" class="w-half mx-auto mt-4">
</div>
</div></p>
</div>
<!-- Interactive Demo -->
<div class="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-gray-100">
    <h3 class="text-xl font-bold text-gray-800 mb-4 mt-4">🔬 Interactive Demo: Adjust the Model Parameters</h3>
    <p class="text-gray-600 mb-4">Adjust the parameters (<code class="text-sm">θ₀</code> and <code class="text-sm">θ₁</code>) to see how the regression line fits the data points.</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Slope (θ₁)</label>
                    <input type="range" id="slope-slider" min="-2" max="2" step="0.01" value="0.8" class="parameter-slider">
                    <span id="slope-value" class="text-sm text-gray-600">0.8</span>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Intercept (θ₀)</label>
                    <input type="range" id="intercept-slider" min="-5" max="5" step="0.01" value="1.2" class="parameter-slider">
                    <span id="intercept-value" class="text-sm text-gray-600">1.2</span>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Loss</label>
                    <span id="loss-value" class="text-sm text-gray-600">0.0</span>
                </div>
                <button id="regenerate-btn" class="btn-secondary w-full">🔄 Generate New Data</button>
            </div>
        </div>
        <div>
            <div id="regression-plot" style="width:100%;height:250px;"></div>
        </div>
    </div>
</div>
<!-- Gradient Descent Section -->
<div class="bg-white rounded-xl shadow-md p-6 mb-8">
    <h3 class="text-2xl font-bold text-gray-800 mb-4 mt-4">⚙️ Gradient Descent: Finding the Bottom of the Hill</h3>
    <p class="text-gray-700 mb-6">We use a powerful optimization algorithm called Gradient Descent to find the values for θ₀ and θ₁ that minimize the cost function J(θ).</p>
    <div class="highlight">
        <strong>Analogy: The Hiker in the Fog</strong>
        <p>Imagine you are a hiker on a hilly landscape in thick fog. To find the lowest point, you would feel the slope at your feet and take a step in the steepest downhill direction. Repeating this process will eventually lead you to the bottom of the valley. This is exactly how Gradient Descent works.</p>
    </div>
    <div class="mt-4">
        <p class="text-gray-600">It works by repeatedly updating the parameters using the following rule: "The new parameter value is the old value minus a small step (the <code class="text-sm">learning rate α</code>) in the direction of the negative gradient."</p>
    </div>
    <img src="/bit07/assets/images/Gradient_descent.gif" alt="Gradient Descent Visualization" class="w-half mx-auto mt-4">
</div>
<!-- Data Pre-processing Section -->
<div class="bg-white rounded-xl shadow-md p-6 mb-8">
    <h3 class="text-2xl font-bold text-gray-800 mb-4 mt-4">🧹 Data Pre-processing: Preparing Data for Modeling</h3>
    <p class="text-gray-700 mb-6">Real-world biological data is rarely "plug-and-play". Proper pre-processing is often more critical for model performance than the choice of algorithm itself.</p>
    <div class="space-y-6">
        <div class="border-l-4 border-blue-400 pl-4">
            <h4 class="font-bold text-gray-800">Feature Scaling</h4>
            <p class="text-gray-600">Transforms features to be on a similar scale, which helps Gradient Descent converge much faster. Common methods include <strong>Standard Scaling</strong> (Z-score), <strong>Min-Max Scaling</strong> and <strong>Robust scaling</strong>.</p>
        </div>
        <div class="border-l-4 border-green-400 pl-4">
            <h4 class="font-bold text-gray-800">Handling Categorical Features</h4>
            <p class="text-gray-600">Models require numerical input. Categorical features (e.g., 'pathway': 'Metabolism', 'Signaling') must be converted. <strong>One-Hot Encoding</strong> is the standard method, creating a new binary column for each category to avoid implying a false ordinal relationship. Another common method is <strong>Label Encoding</strong>, which assigns a unique integer to each category. Note that this will imply an ordinal relationship between the categories.</p>
        </div>
        <div class="border-l-4 border-purple-400 pl-4">
            <h4 class="font-bold text-gray-800">Handling Non-Linearity</h4>
            <p class="text-gray-600">If the relationship isn't a straight line, we can create <strong>polynomial features</strong> (e.g., adding x² as a new feature) to allow the linear model to fit a curve.</p>
        </div>
        <div class="alert-warning mt-6">
            <strong>Critical Concept: Preventing Data Leakage</strong>
            <p>All pre-processing steps (like calculating the mean for scaling) must be learned from the <strong>training set only</strong>. This learned transformation is then applied to both the training and test sets. Fitting on the entire dataset before splitting "leaks" information from the test set into the training process, leading to an overly optimistic performance evaluation.</p>
        </div>
    </div>
</div>
<!-- Bias-Variance and Regularization Section -->
<div class="bg-white rounded-xl shadow-md p-6 mb-8">
    <h3 class="text-2xl font-bold text-gray-800 mb-4 mt-4">🎯 The Bias-Variance Trade-off & Regularization</h3>
    <p class="text-gray-700 mb-4">A central challenge in machine learning is navigating the trade-off between a model that is too simple (<strong>high bias, underfitting</strong>) and one that is too complex and learns the noise in the data (<strong>high variance, overfitting</strong>). This is especially true in bioinformatics, where we often have many features (e.g., genes) and few samples (e.g., patients).</p>
    <p class="text-gray-700 mb-6"><strong>Regularization</strong> is the primary technique to combat overfitting. It works by adding a penalty to the cost function that discourages the model's parameters (θ) from becoming too large.</p>
<p><div class="grid grid-cols-1 md:grid-cols-3 gap-8">
<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
<h4 class="text-lg font-bold text-blue-800 mb-2">Ridge Regression (L2 Penalty)</h4>
<p class="text-blue-700">Adds a penalty proportional to the <strong>square</strong> of the coefficients' magnitude. This shrinks large coefficients towards zero but rarely makes them exactly zero. Use this when you believe most features are useful.</p>
</div>
<div class="bg-green-50 border border-green-200 rounded-lg p-4">
<h4 class="text-lg font-bold text-green-800 mb-2">Lasso Regression (L1 Penalty)</h4>
<p class="text-green-700">Adds a penalty proportional to the <strong>absolute value</strong> of the coefficients' magnitude. This can shrink coefficients to be exactly zero, effectively performing automatic <strong>feature selection</strong>. Use this when you suspect many features are irrelevant.</p>
</div>
<div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
<h4 class="text-lg font-bold text-purple-800 mb-2">Elastic Net</h4>
<p class="text-purple-700">A combination of Ridge and Lasso. The penalty is a weighted sum of the two penalties, with a higher weight given to Ridge.</p>
</div>
</div></p>
</div>
<!-- Improved Ridge vs Lasso Visualization Section -->
<div class="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-gray-100">
  <h3 class="text-xl font-bold text-gray-800 mb-4 mt-4">🔍 Interactive: Ridge vs Lasso Regularization</h3>
  <p class="text-gray-700 mb-4">
    See how the total loss J(θ) = MSE(θ) + α·Penalty(θ) changes with the regularization type and strength.
  </p>
<p class="text-gray-700 mb-4">
  The white cross indicates the most optimal model without regularization, the red dot is the most optimal model with regulariztaion.
</p>
  <div class="grid grid-cols-2 md:grid-cols-2 gap-4 mb-4">
    <div class="">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Regularization Type</label>
          <div class="flex space-x-4 mb-4">
            <button id="ridge-btn" class="px-4 py-2 bg-blue-500 text-white rounded-md">Ridge (L2)</button>
            <button id="lasso-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Lasso (L1)</button>
          </div>
        </div>
<p><div>
<label class="block text-sm font-medium text-gray-700 mb-2">Regularization Strength (α)</label>
<input type="range" id="alpha-slider" min="0" max="5" step="0.1" value="1" class="parameter-slider w-full">
<span id="alpha-value" class="text-sm text-gray-600">1.0</span>
</div></p>
<p><div>
<label class="block text-sm font-medium text-gray-700 mb-2">3D Surface</label>
<div class="flex items-center gap-3 text-sm">
<label class="inline-flex items-center gap-1">
<input type="radio" name="surfaceMode" value="total" checked>
<span>Total</span>
</label>
<label class="inline-flex items-center gap-1">
<input type="radio" name="surfaceMode" value="mse">
<span>MSE</span>
</label>
<label class="inline-flex items-center gap-1">
<input type="radio" name="surfaceMode" value="reg">
<span>Regularizer</span>
</label>
</div>
</div></p>
<p><div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-700 space-y-1">
<div><strong>Unregularized optimum (×):</strong> θ* = (2, -1)</div>
<div><strong>Regularized optimum (●):</strong> <span id="opt-coords">θ_α = (?, ?)</span></div>
<div id="reg-explanation">
Ridge: circular constraint regions shrink coefficients proportionally.
</div>
</div>
</div>
</div>
<div class="">
<div id="surface-plot" style="width:100%;height:260px;"></div>
</div></p>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div>
      <div class="text-center text-sm font-semibold mb-1">Mean Squared Error</div>
      <div id="mse-contour" style="width:100%;height:220px;"></div>
    </div>
    <div>
      <div class="text-center text-sm font-semibold mb-1">Regularizer</div>
      <div id="reg-contour" style="width:100%;height:220px;"></div>
    </div>
    <div>
      <div class="text-center text-sm font-semibold mb-1">Total Loss</div>
      <div id="total-contour" style="width:100%;height:220px;"></div>
    </div>
    <div>
      <div class="text-center text-sm font-semibold mb-1">Overlay: MSE + Constraint</div>
      <div id="overlay-contour" style="width:100%;height:220px;"></div>
    </div>
  </div>
</div>
<!-- Multivariate Linear Regression -->
<div class="bg-white rounded-2xl shadow-lg p-6 mb-8 border border-gray-100">
    <h3 class="text-xl font-bold text-gray-800 mb-4 mt-4">📈 Multivariate Linear Regression</h3>
    <p class="text-gray-700 mb-4">In many biological applications, we have multiple features that influence the target variable. Multivariate linear regression extends the simple linear model to accommodate multiple input features.</p>
    <div class="bg-gray-100 rounded-lg p-4 font-mono text-center mb-4">
        <code class="text-lg">hθ(x) = θ₀ + θ₁x₁ + θ₂x₂ + ... + θₙxₙ</code>
    </div>
    <p class="text-gray-700 mb-4">Here, each <code class="text-sm">xᵢ</code> represents a different feature (e.g., expression levels of different genes), and each <code class="text-sm">θᵢ</code> is the corresponding coefficient that quantifies its contribution to the prediction.</p>
    <p class="text-gray-700">The principles of cost minimization, gradient descent, and regularization apply similarly in the multivariate case, allowing us to build robust models even with many features.</p>
</div>
<div id="next-steps" class="bg-gradient-to-r from-primary-100 to-secondary      -100 rounded-2xl p-8 text-center">
    <h3 class="text-2xl font-bold gradient-text mb-4">Next Steps</h3>
    <p class="text-gray-700 max-w-3xl mx-auto">You now understand how to build, optimize, and regularize a linear regression model. The next step is to adapt these ideas for classification problems.</p>
    <div class="flex flex-wrap justify-center gap-4 mt-6">
        <a href="/bit07/logistic-regression/" class="btn-primary">Next: Logistic Regression →</a>
        <a href="/bit07/introduction/" class="btn-secondary">← Previous: Introduction</a>
    </div>
</div>
<script>
    let data = generateData();
    function generateData() {
        const n = 50;
        const x_vals = Array.from({length: n}, () => Math.random() * 10);
        const noise_level = 3;
        const y_vals = x_vals.map(x => 1.5 + 0.5 * x + (Math.random() - 0.5) * noise_level);
        return {x: x_vals, y: y_vals};
    }
    // Interactive Linear Regression Demo
    function updatePlot() {
        const slope = parseFloat(document.getElementById('slope-slider').value);
        const intercept = parseFloat(document.getElementById('intercept-slider').value);
        
        document.getElementById('slope-value').textContent = slope.toFixed(2);
        document.getElementById('intercept-value').textContent = intercept.toFixed(2);

        const x_vals = data.x;
        const y_vals = data.y;
        const n = x_vals.length;
        
        const user_line_x = [0, 10];
        const user_line_y = [intercept, intercept + slope * 10];

        let loss = 0;
        for (let i = 0; i < n; i++) {
            const y_hat = slope * x_vals[i] + intercept;
            const error = y_vals[i] - y_hat;
            loss += error * error;
        }

        // Update loss
        document.getElementById('loss-value').textContent = loss.toFixed(2);
        
        const data_points = {
            x: x_vals,
            y: y_vals,
            mode: 'markers',
            type: 'scatter',
            name: 'Biological Data',
            marker: { color: '#3B82F6', size: 8 }
        };
        
        const user_line = {
            x: user_line_x,
            y: user_line_y,
            mode: 'lines',
            type: 'scatter',
            name: 'Your Model',
            line: { color: '#EF4444', width: 3 }
        };
        
        const layout = {
            title: 'Gene Expression vs. Drug Dose',
            xaxis: { title: 'Drug Dose (μM)' },
            yaxis: { title: 'Gene Expression' },
            margin: { t: 40, r: 20, b: 40, l: 50 },
            showlegend: false,
            font: {size: 10}
        };
        
        Plotly.newPlot('regression-plot', [data_points, user_line], layout);
    }
    
    document.getElementById('slope-slider').addEventListener('input', updatePlot);
    document.getElementById('intercept-slider').addEventListener('input', updatePlot);
    document.getElementById('regenerate-btn').addEventListener('click', () => {
        data = generateData();
        updatePlot();
    });
    
    document.addEventListener('DOMContentLoaded', updatePlot);
</script>
<script>
  // Self-contained, fixes any missing brace issues
  document.addEventListener('DOMContentLoaded', function () {
    // Ground-truth minimum of the simplified MSE: (2, -1)
    const t1 = 2, t2 = -1;

    // State
    let regType = 'ridge';
    let alpha = 1.0;
    let surfaceMode = 'total';

    // Grid
    const n = 60;
    const range = 4;
    const theta1 = Array.from({ length: n }, (_, i) => -range + i * (2 * range) / (n - 1));
    const theta2 = Array.from({ length: n }, (_, i) => -range + i * (2 * range) / (n - 1));

    // Helpers
    function softThreshold(v, lam) {
      const s = Math.sign(v) * Math.max(Math.abs(v) - lam, 0);
      return s;
    }

    // Analytic regularized optimum for this toy problem:
    // MSE(θ) = (θ1 - t1)^2 + (θ2 - t2)^2
    // Ridge: θ = t / (1 + α)
    // Lasso: θ = soft_threshold(t, α/2) coordinate-wise
    function analyticOptimum() {
      if (regType === 'ridge') {
        const denom = 1 + alpha;
        return { th1: t1 / denom, th2: t2 / denom };
      } else {
        const lam = alpha / 2;
        return { th1: softThreshold(t1, lam), th2: softThreshold(t2, lam) };
      }
    }

    function buildLosses() {
      const mse = [];
      const reg = [];
      const total = [];
      for (let i = 0; i < n; i++) {
        const rowM = [], rowR = [], rowT = [];
        for (let j = 0; j < n; j++) {
          const x = theta1[i];
          const y = theta2[j];
          const mseVal = (x - t1) * (x - t1) + (y - t2) * (y - t2);
          let regVal = 0;
          if (regType === 'ridge') {
            regVal = alpha * (x * x + y * y);
          } else {
            regVal = alpha * (Math.abs(x) + Math.abs(y));
          }
          rowM.push(mseVal);
          rowR.push(regVal);
          rowT.push(mseVal + regVal);
        }
        mse.push(rowM);
        reg.push(rowR);
        total.push(rowT);
      }
      return { mse, reg, total };
    }

    function diamondPoints(c) {
      // |x| + |y| = c
      return {
        x: [ c,  0, -c,  0,  c],
        y: [ 0,  c,  0, -c,  0]
      };
    }

    function circlePoints(r, k = 120) {
      const x = [], y = [];
      for (let i = 0; i <= k; i++) {
        const a = i * 2 * Math.PI / k;
        x.push(r * Math.cos(a));
        y.push(r * Math.sin(a));
      }
      return { x, y };
    }

    function update() {
      // Compute losses
      const { mse, reg, total } = buildLosses();

      // Optima
      const opt = analyticOptimum();
      const optText = `θ\_α = (${opt.th1.toFixed(2)}, ${opt.th2.toFixed(2)})`;
      document.getElementById('opt-coords').textContent = optText;

      // Colors
      const blue = 'Blues';
      const orange = 'Oranges';
      const viridis = 'Viridis';

      // Layouts
      const base2D = {
        showlegend: false,
        margin: { t: 20, r: 10, b: 30, l: 40 },
        xaxis: { title: 'θ₁', range: [-range, range], zeroline: false },
        yaxis: { title: 'θ₂', range: [-range, range], zeroline: false },
        font: { size: 10 }
      };

      // MSE contour
      Plotly.newPlot('mse-contour', [
        {
          x: theta1, y: theta2, z: mse, type: 'contour',
          colorscale: blue, contours: { coloring: 'heatmap' }, showscale: false
        },
        {
          x: [t1], y: [t2], type: 'scatter', mode: 'markers',
          marker: { color: 'white', size: 8, symbol: 'x' }, name: 'Unregularized Optimum'
        }
      ], base2D);

      // Regularizer contour
      Plotly.newPlot('reg-contour', [
        {
          x: theta1, y: theta2, z: reg, type: 'contour',
          colorscale: orange, contours: { coloring: 'heatmap' }, showscale: false
        }
      ], base2D);

      // Total contour
      Plotly.newPlot('total-contour', [
        {
          x: theta1, y: theta2, z: total, type: 'contour',
          colorscale: viridis, contours: { coloring: 'heatmap' }, showscale: false
        },
        {
          x: [opt.th1], y: [opt.th2], type: 'scatter', mode: 'markers',
          marker: { color: 'red', size: 8, symbol: 'circle' }, name: 'Regularized Optimum'
        },
        {
          x: [t1], y: [t2], type: 'scatter', mode: 'markers',
          marker: { color: 'white', size: 8, symbol: 'x' }, name: 'Unregularized Optimum'
        }
      ], base2D);

      // Overlay: MSE line contours + regularizer level set + optima
      const overlayTraces = [
        {
          x: theta1, y: theta2, z: mse, type: 'contour',
          colorscale: blue, contours: { coloring: 'lines', showlines: true }, showscale: false
        },
        {
          x: [opt.th1], y: [opt.th2], type: 'scatter', mode: 'markers',
          marker: { color: 'red', size: 8, symbol: 'circle' }, name: 'Regularized Optimum'
        },
        {
          x: [t1], y: [t2], type: 'scatter', mode: 'markers',
          marker: { color: 'black', size: 8, symbol: 'x' }, name: 'Unregularized Optimum'
        }
      ];

      // Add constraint boundary passing through the regularized optimum
      if (regType === 'ridge') {
        const r = Math.hypot(opt.th1, opt.th2);
        const circ = circlePoints(r);
        overlayTraces.push({
          x: circ.x, y: circ.y, type: 'scatter', mode: 'lines',
          line: { color: '#fb923c', width: 2 }, name: 'L2 level set'
        });
        document.getElementById('reg-explanation').textContent =
          'Ridge: circular constraint regions shrink coefficients proportionally.';
      } else {
        const c = Math.abs(opt.th1) + Math.abs(opt.th2);
        const dia = diamondPoints(c);
        overlayTraces.push({
          x: dia.x, y: dia.y, type: 'scatter', mode: 'lines',
          line: { color: '#fb923c', width: 2 }, name: 'L1 level set'
        });
        document.getElementById('reg-explanation').textContent =
          'Lasso: diamond constraint encourages sparsity (exact zeros).';
      }

      Plotly.newPlot('overlay-contour', overlayTraces, base2D);

      // 3D surface (selectable)
      drawSurface(surfaceMode, { mse, reg, total });
    }

    function drawSurface(mode, losses) {
      let z = losses.total, title = '3D: Total Loss';
      if (mode === 'mse') { z = losses.mse; title = '3D: MSE'; }
      if (mode === 'reg') { z = losses.reg; title = '3D: Regularizer'; }

      const data = [{
        x: theta1, y: theta2, z, type: 'surface', colorscale: 'Viridis', showscale: false,
        contours: { z: { show: true, usecolormap: true, project: { z: true } } }
      }];

      const layout = {
        title,
        scene: {
          xaxis: { title: 'θ₁' },
          yaxis: { title: 'θ₂' },
          zaxis: { title: 'Cost' },
          camera: { eye: { x: 1.5, y: 1.5, z: 1.2 } }
        },
        margin: { t: 30, r: 0, b: 0, l: 0 },
        font: { size: 10 }
      };

      Plotly.newPlot('surface-plot', data, layout);
    }

    // Events
    document.getElementById('ridge-btn').addEventListener('click', function () {
      regType = 'ridge';
      this.className = 'px-4 py-2 bg-blue-500 text-white rounded-md';
      document.getElementById('lasso-btn').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-md';
      update();
    });

    document.getElementById('lasso-btn').addEventListener('click', function () {
      regType = 'lasso';
      this.className = 'px-4 py-2 bg-blue-500 text-white rounded-md';
      document.getElementById('ridge-btn').className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-md';
      update();
    });

    document.getElementById('alpha-slider').addEventListener('input', function () {
      alpha = parseFloat(this.value);
      document.getElementById('alpha-value').textContent = alpha.toFixed(1);
      update();
    });

    document.querySelectorAll('input[name="surfaceMode"]').forEach(r => {
      r.addEventListener('change', (e) => {
        surfaceMode = e.target.value;
        // Redraw surfaces only; contours update is not needed here
        const losses = buildLosses();
        drawSurface(surfaceMode, losses);
      });
    });

    // Initial render
    document.getElementById('alpha-value').textContent = alpha.toFixed(1);
    update();
  });
</script>
            </div>
        </div>
    </main>

    <!-- Floating Code Examples Toggle Button -->
    <button id="code-examples-toggle" aria-label="Open code examples"
            class="fixed bottom-6 right-6 z-50 rounded-full shadow-lg bg-primary-600 hover:bg-primary-700 text-white px-4 py-3 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 18l6-6-6-6M8 6l-6 6 6 6"></path>
        </svg>
        <span class="hidden md:inline">Code Examples</span>
    </button>

    <!-- Off-canvas Code Examples Panel -->
    <div id="code-examples-panel" class="fixed inset-0 z-50 hidden">
        <!-- Backdrop -->
        <div id="code-examples-backdrop" class="absolute inset-0 bg-black/40"></div>
        <!-- Panel -->
        <aside class="absolute right-0 top-0 h-full w-full md:w-[36rem] bg-white shadow-2xl border-l border-gray-200 flex flex-col">
            <div class="p-4 border-b flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-800">Chapter Code Examples</h2>
                <button id="code-examples-close" class="p-2 rounded hover:bg-gray-100" aria-label="Close">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="code-examples-content" class="flex-1 overflow-y-auto p-4 space-y-6">
                <!-- Injected dynamically by interactive.js -->
            </div>
        </aside>
    </div>

    <footer id="footer" class="bg-gray-900 text-gray-300">
        <div class="container mx-auto px-4 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold text-white mb-4">BIT07 Machine Learning</h3>
                    <p class="text-gray-400">Comprehensive machine learning course for bioinformatics applications by Cedric Hermans.</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="/bit07/introduction/" class="text-gray-400 hover:text-primary-400 transition-colors">Getting Started</a></li>
                        <li><a href="/bit07/linear-regression/" class="text-gray-400 hover:text-primary-400 transition-colors">Linear Models</a></li>
                        <li><a href="/bit07/neural-networks/" class="text-gray-400 hover:text-primary-400 transition-colors">Deep Learning</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">Resources</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-primary-400 transition-colors">Course Materials</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary-400 transition-colors">Interactive Examples</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-primary-400 transition-colors">GitHub Repository</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p>&copy; 2025 BIT07 Machine Learning Course by Cedric Hermans. Educational content for machine learning in bioinformatics.</p>
            </div>
        </div>
    </footer>

    <style>
        .nav-link {
            @apply px-3 py-2 rounded-lg text-sm font-medium hover:bg-white hover:bg-opacity-10 transition-colors whitespace-nowrap;
        }

        .nav-link-mobile {
            @apply block px-3 py-2 rounded-lg text-sm font-medium hover:bg-white hover:bg-opacity-10 transition-colors;
        }
    </style>

    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            const mobileNav = document.getElementById('mobile-nav');
            mobileNav.classList.toggle('hidden');
        });

        // Toggle code examples panel
        document.getElementById('code-examples-toggle').addEventListener('click', function() {
            const panel = document.getElementById('code-examples-panel');
            panel.classList.toggle('hidden');
        });

        // Close code examples panel
        document.getElementById('code-examples-close').addEventListener('click', function() {
            const panel = document.getElementById('code-examples-panel');
            panel.classList.add('hidden');
        });

        // Initialize syntax highlighting
        hljs.highlightAll();

        // Add copy button to code blocks (static content)
        document.querySelectorAll('pre code').forEach((codeBlock) => {
            const button = document.createElement('button');
            button.className = 'absolute top-2 right-2 px-2 py-1 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs rounded transition-colors';
            button.textContent = 'Copy';

            button.addEventListener('click', () => {
                navigator.clipboard.writeText(codeBlock.textContent);
                button.textContent = 'Copied!';
                setTimeout(() => button.textContent = 'Copy', 2000);
            });

            codeBlock.parentNode.style.position = 'relative';
            codeBlock.parentNode.appendChild(button);
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
    <!-- Shared interactive demos bundle -->
    <script src="/bit07/assets/js/interactive.js"></script>
</body>
</html>
